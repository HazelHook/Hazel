NODE hourly_res
SQL >

    SELECT
        toStartOfHour(timestamp) AS bucket,
        customer_id,
        source_id,
        status,
        countState() AS count
    FROM response_events
    GROUP BY
        bucket,
        source_id,
        customer_id,
        status

TYPE materialized
DATASOURCE hourly_res_mv
ENGINE "AggregatingMergeTree"
ENGINE_PARTITION_KEY "toYYYYMM(bucket)"
ENGINE_SORTING_KEY "bucket, source_id, customer_id, status"
ENGINE_TTL "bucket + toIntervalDay(120)"

